{"version":3,"sources":["webpack://@studip/core/./resources/vue/components/BlubberThreadWidget.vue?ddd3","webpack://@studip/core/resources/vue/components/BlubberThreadWidget.vue","webpack://@studip/core/./resources/vue/components/BlubberThreadWidget.vue?29e6","webpack://@studip/core/./resources/vue/components/BlubberThreadWidget.vue","webpack://@studip/core/./node_modules/vue-loader/lib/runtime/componentNormalizer.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","directives","name","rawName","staticClass","attrs","tag","_l","sortedThreads","thread","key","thread_id","class","active_thread","unseen_comments","on","click","$event","preventDefault","changeActiveThread","href","link","style","backgroundImage","avatar","_v","_s","timestamp","relative","display_more_down","file","width","_e","_withStripped","component","options","__file","normalizeComponent","scriptExports","staticRenderFns","functionalTemplate","injectStyles","scopeId","moduleIdentifier","shadowMode","hook","_compiled","functional","_scopeId","context","$vnode","ssrContext","parent","__VUE_SSR_CONTEXT__","call","_registeredComponents","add","_ssrRegister","$root","$options","shadowRoot","_injectStyles","originalRender","h","existing","beforeCreate","concat","exports"],"mappings":"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","file":"javascripts/221.chunk.js","sourcesContent":["var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    {\n      directives: [{ name: \"scroll\", rawName: \"v-scroll\" }],\n      staticClass: \"scrollable_area blubber_thread_widget\"\n    },\n    [\n      _c(\n        \"transition-group\",\n        { attrs: { name: \"blubberthreadwidget-list\", tag: \"ol\" } },\n        [\n          _vm._l(_vm.sortedThreads, function(thread) {\n            return _c(\n              \"li\",\n              {\n                key: thread.thread_id,\n                class:\n                  (_vm.active_thread === thread.thread_id ? \"active\" : \"\") +\n                  (thread.unseen_comments > 0 ? \" unseen\" : \"\"),\n                attrs: {\n                  \"data-thread_id\": thread.thread_id,\n                  \"data-unseen_comments\": thread.unseen_comments\n                },\n                on: {\n                  click: function($event) {\n                    $event.preventDefault()\n                    return _vm.changeActiveThread($event)\n                  }\n                }\n              },\n              [\n                _c(\"a\", { attrs: { href: _vm.link(thread.thread_id) } }, [\n                  _c(\"div\", {\n                    staticClass: \"avatar\",\n                    style: { backgroundImage: \"url(\" + thread.avatar + \")\" }\n                  }),\n                  _vm._v(\" \"),\n                  _c(\n                    \"div\",\n                    { staticClass: \"info\" },\n                    [\n                      _c(\"div\", { staticClass: \"name\" }, [\n                        _vm._v(\n                          \"\\n                            \" +\n                            _vm._s(thread.name) +\n                            \"\\n                        \"\n                        )\n                      ]),\n                      _vm._v(\" \"),\n                      _c(\"studip-date-time\", {\n                        attrs: { timestamp: thread.timestamp, relative: true }\n                      })\n                    ],\n                    1\n                  )\n                ])\n              ]\n            )\n          }),\n          _vm._v(\" \"),\n          _vm.display_more_down\n            ? _c(\n                \"li\",\n                { key: \"more\", staticClass: \"more\" },\n                [\n                  _c(\"studip-asset-img\", {\n                    attrs: { file: \"ajax-indicator-black.svg\", width: \"20\" }\n                  })\n                ],\n                1\n              )\n            : _vm._e()\n        ],\n        2\n      )\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","<template>\n    <div class=\"scrollable_area blubber_thread_widget\" v-scroll>\n        <transition-group name=\"blubberthreadwidget-list\"\n                          tag=\"ol\">\n                <li v-for=\"thread in sortedThreads\"\n                    :key=\"thread.thread_id\"\n                    :data-thread_id=\"thread.thread_id\"\n                    :class=\"(active_thread === thread.thread_id ? 'active' : '') + (thread.unseen_comments > 0 ? ' unseen' : '')\"\n                    :data-unseen_comments=\"thread.unseen_comments\"\n                    @click.prevent=\"changeActiveThread\">\n                    <a :href=\"link(thread.thread_id)\">\n                        <div class=\"avatar\"\n                             :style=\"{ backgroundImage: 'url(' + thread.avatar + ')' }\">\n                        </div>\n                        <div class=\"info\">\n                            <div class=\"name\">\n                                {{ thread.name }}\n                            </div>\n                            <studip-date-time :timestamp=\"thread.timestamp\" :relative=\"true\"></studip-date-time>\n                        </div>\n                    </a>\n                </li>\n                <li class=\"more\" v-if=\"display_more_down\" key=\"more\">\n                    <studip-asset-img file=\"ajax-indicator-black.svg\" width=\"20\"></studip-asset-img>\n                </li>\n        </transition-group>\n    </div>\n</template>\n\n<script>\n    export default {\n        name: 'blubber-thread-widget',\n        props: ['threads', 'active_thread', 'more_down'],\n        data () {\n            return {\n                display_more_down: this.more_down,\n                already_loading_down: 0\n            };\n        },\n        methods: {\n            changeActiveThread (event) {\n                let li = $(event.target).closest('li');\n                if (!li.hasClass('active')) {\n                    li.siblings('.active').removeClass('active');\n                    li.addClass('active');\n                    this.$root.changeActiveThread(li.data('thread_id'));\n                }\n            },\n            link (thread_id) {\n                return STUDIP.URLHelper.getURL(`dispatch.php/blubber/index/${thread_id}`);\n            },\n            addThread (thread) {\n                let thread_ids = this.threads.map((t) => t.thread_id);\n                if (thread_ids.indexOf(thread.thread_id) !== -1) {\n                    return;\n                }\n                this.threads.push(thread);\n            }\n        },\n        directives: {\n            scroll: {\n                // directive definition\n                inserted (el) {\n                    let threads = el.__vue__;\n                    $(el).parent().on('scroll', function (event) {\n                        let top = $(el).parent().scrollTop();\n                        let height = $(el).height();\n\n                        $(el).toggleClass('scrolled', top > 0);\n\n                        if (!threads.display_more_down || (top <= height - 1000) || threads.already_loading_down) {\n                            return;\n                        }\n\n                        threads.already_loading_down = true;\n\n                        let latest_timestamp = threads.threads.reduce((max, thread) => {\n                            if (thread.thread_id === 'global') {\n                                return max;\n                            }\n                            return max === null ? thread.timestamp : Math.min(max, thread.timestamp);\n                        }, null);\n\n                        //load newer comments\n                        STUDIP.api.GET('blubber/threads', {\n                            data: {\n                                modifier: 'olderthan',\n                                timestamp: latest_timestamp,\n                                limit: 50\n                            }\n                        }).done((data) => {\n                            data.threads.forEach((thread) => threads.addThread(thread));\n\n                            threads.display_more_down = data.more_down;\n                        }).always(() => {\n                            threads.already_loading_down = false;\n                        });\n                    });\n                }\n            }\n        },\n        mounted: function () {\n\n        },\n        computed: {\n            sortedThreads () {\n                return this.threads.sort((a, b) => b.timestamp - a.timestamp);\n            }\n        }\n    }\n</script>\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BlubberThreadWidget.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BlubberThreadWidget.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./BlubberThreadWidget.vue?vue&type=template&id=2331ddae&\"\nimport script from \"./BlubberThreadWidget.vue?vue&type=script&lang=js&\"\nexport * from \"./BlubberThreadWidget.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/home/mlunzena/Sync/Projects/studip/devActivities/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('2331ddae')) {\n      api.createRecord('2331ddae', component.options)\n    } else {\n      api.reload('2331ddae', component.options)\n    }\n    module.hot.accept(\"./BlubberThreadWidget.vue?vue&type=template&id=2331ddae&\", function () {\n      api.rerender('2331ddae', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"resources/vue/components/BlubberThreadWidget.vue\"\nexport default component.exports","/* globals __VUE_SSR_CONTEXT__ */\n\n// IMPORTANT: Do NOT use ES2015 features in this file (except for modules).\n// This module is a runtime utility for cleaner component module output and will\n// be included in the final webpack user bundle.\n\nexport default function normalizeComponent (\n  scriptExports,\n  render,\n  staticRenderFns,\n  functionalTemplate,\n  injectStyles,\n  scopeId,\n  moduleIdentifier, /* server only */\n  shadowMode /* vue-cli only */\n) {\n  // Vue.extend constructor export interop\n  var options = typeof scriptExports === 'function'\n    ? scriptExports.options\n    : scriptExports\n\n  // render functions\n  if (render) {\n    options.render = render\n    options.staticRenderFns = staticRenderFns\n    options._compiled = true\n  }\n\n  // functional template\n  if (functionalTemplate) {\n    options.functional = true\n  }\n\n  // scopedId\n  if (scopeId) {\n    options._scopeId = 'data-v-' + scopeId\n  }\n\n  var hook\n  if (moduleIdentifier) { // server build\n    hook = function (context) {\n      // 2.3 injection\n      context =\n        context || // cached call\n        (this.$vnode && this.$vnode.ssrContext) || // stateful\n        (this.parent && this.parent.$vnode && this.parent.$vnode.ssrContext) // functional\n      // 2.2 with runInNewContext: true\n      if (!context && typeof __VUE_SSR_CONTEXT__ !== 'undefined') {\n        context = __VUE_SSR_CONTEXT__\n      }\n      // inject component styles\n      if (injectStyles) {\n        injectStyles.call(this, context)\n      }\n      // register component module identifier for async chunk inferrence\n      if (context && context._registeredComponents) {\n        context._registeredComponents.add(moduleIdentifier)\n      }\n    }\n    // used by ssr in case component is cached and beforeCreate\n    // never gets called\n    options._ssrRegister = hook\n  } else if (injectStyles) {\n    hook = shadowMode\n      ? function () {\n        injectStyles.call(\n          this,\n          (options.functional ? this.parent : this).$root.$options.shadowRoot\n        )\n      }\n      : injectStyles\n  }\n\n  if (hook) {\n    if (options.functional) {\n      // for template-only hot-reload because in that case the render fn doesn't\n      // go through the normalizer\n      options._injectStyles = hook\n      // register for functional component in vue file\n      var originalRender = options.render\n      options.render = function renderWithStyleInjection (h, context) {\n        hook.call(context)\n        return originalRender(h, context)\n      }\n    } else {\n      // inject component registration as beforeCreate hook\n      var existing = options.beforeCreate\n      options.beforeCreate = existing\n        ? [].concat(existing, hook)\n        : [hook]\n    }\n  }\n\n  return {\n    exports: scriptExports,\n    options: options\n  }\n}\n"],"sourceRoot":""}